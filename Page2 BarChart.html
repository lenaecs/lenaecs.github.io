<html>
<script src="https://d3js.org/d3.v4.js"></script>
<style> rect {fill: lightgreen; stroke: black;} </style>

<svg width=600 height=300>
</svg>

<div id="race_percentiles"></div>


<script>

d3.csv("./data/percentile_race.csv", function(data){

var svg = d3.select("#race_percentiles")
  .select("svg")
  .append("g")

var subgroups = data.columns.slice(1)
var par_pctiles = d3.map(data, function(d){return(d.par_pctile)}).keys()

var y = d3.scaleLinear()
      .domain([0,100])
      .range([200,0]);

var x = d3.scaleBand()
      .domain(par_pctiles)
      .range([0, 400])
      .padding(.02);

var xSubgroup = d3.scaleBand()
    .domain(subgroups)
    .range([0, x.bandwidth()])
    .padding([0.05])

  var color = d3.scaleOrdinal()
    .domain(subgroups)
    .range(['lightgreen', 'lightblue'])

d3.select("svg")
  .append("g")
  .attr("transform", "translate(50,50)")
  .call(d3.axisLeft(y)
          .tickValues([5, 10, 15, 2, 25])
          .tickFormat(d3.format("0")))


d3.select("svg")
  .append("g")
  .attr("transform", "translate(50,250)")
  .call(d3.axisBottom(x).tickSize(0))
  .selectAll("text")
  .attr("transform", "rotate(45)");

  svg.append("g")
    .selectAll("g")
    .data(data)
    .enter()
    .append("g")
      .attr("transform", function(d) { return "translate(" + x(d.par_pctiles) + ",0)"; })
    .selectAll("rect")
  .data(function(d) { return subgroups.map(function(key) { return {key: key, value: d[key]}; }); })
  .enter().append("rect")
  .attr("x", function(d) {return xSubgroup(d.key);})
  .attr("y", function(d) { return y(d.value);})
  .attr("width", xSubgroup.bandwidth())
  .attr("height", function(d) {return 200 - y(d.value);})
  .attr("fill", function(d) { return color(d.key); });

})


</script>
<body>
</body>
</html>
